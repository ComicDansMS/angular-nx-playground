const fs = require('fs');
const path = require('path');
const CleanCSS = require('clean-css');

const cssFilePath = process.argv[2];
const styleTsPath = process.argv[3];

function processStyles() {
  try {
    const cssFile = fs.readFileSync(cssFilePath, 'utf8').trim();
    const cleanCSS = new CleanCSS({ compatibility: '*' });
    const minified = cleanCSS.minify(cssFile);
    
    if (minified.errors.length > 0) {
      console.error('CSS minification errors:', minified.errors);
      process.exit(1);
    }

    const newFileContents = `
/**
* THIS FILE IS AUTOMATICALLY GENERATED
* DO NOT EDIT DIRECTLY!
* 
* Edit the original stylesheet at:
* ${cssFilePath}
*/

export const style = \`${minified.styles}\`
    `;

    
    const newFilePath = path.resolve(styleTsPath);
    fs.writeFileSync(newFilePath, newFileContents);
    console.log(`✅ CSS minified and injected: ${path.basename(cssFilePath)} → ${path.basename(styleTsPath)}`);
  } catch (error) {
    console.error('Error processing CSS:', error);
    process.exit(1);
  }
}

processStyles();
